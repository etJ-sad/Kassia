<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kassia - Windows Image Preparation System | Siemens</title>

    <!-- Siemens Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.c2comms.cloud/images/favicons/1.0/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.c2comms.cloud/images/favicons/1.0/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.c2comms.cloud/images/favicons/1.0/favicon-16x16.png">
    <link rel="shortcut icon" href="https://cdn.c2comms.cloud/images/favicons/1.0/favicon.ico">

    <!-- Siemens Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS Files -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
</head>
<body>
    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status status-offline">
        <span data-translate="connection_connecting">🔌 Connecting...</span>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Siemens Header -->
    <header class="siemens-header">
        <!-- Main Header -->
        <div class="header-main">
            <div class="header-main-content">
                <a href="#" class="siemens-logo">
                    <div class="logo-icon">S</div>
                    <span>SIEMENS</span>
                </a>

                <div class="header-search">
                    <div class="search-container">
                        <input type="text" class="search-input" data-translate-placeholder="search_placeholder" placeholder="Search Kassia documentation..." id="headerSearch">
                    </div>
                </div>

                <div class="language-selector">
                    <button class="lang-btn active" onclick="switchLanguage('en')">EN</button>
                    <button class="lang-btn" onclick="switchLanguage('de')">DE</button>
                    <button class="lang-btn" onclick="switchLanguage('ru')">RU</button>
                    <button class="lang-btn" onclick="switchLanguage('cs')">CS</button>
                </div>
            </div>
        </div>

        <!-- Main Navigation -->
        <div class="main-navigation">
            <div class="nav-content">
                <div class="nav-item active" onclick="switchTab('dashboard')">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M6 1v3H1V1h5zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12v3h-5v-3h5zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8v7H1V8h5zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6v7h-5V1h5zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z"/>
                    </svg>
                    <span data-translate="nav_dashboard">Dashboard</span>
                </div>
                <div class="nav-item" onclick="switchTab('build')">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                    </svg>
                    <span data-translate="nav_build">New Build</span>
                </div>
                <div class="nav-item" onclick="switchTab('assets')">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 14.5 0h-13z"/>
                    </svg>
                    <span data-translate="nav_assets">Assets</span>
                </div>
                <div class="nav-item" onclick="switchTab('jobs')">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M7 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-1z"/>
                    </svg>
                    <span data-translate="nav_jobs">Jobs</span>
                </div>
                <div class="nav-item" onclick="switchTab('admin')">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.892 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.892-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/>
                    </svg>
                    <span data-translate="nav_admin">Admin</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Tab Navigation -->
		<!--
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M6 1v3H1V1h5zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12v3h-5v-3h5zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8v7H1V8h5zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6v7h-5V1h5zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z"/>
                    </svg>
                <span data-translate="nav_dashboard">Dashboard</span>
            </button>
            <button class="tab-btn" data-tab="build" onclick="switchTab('build')">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                </svg>
                <span data-translate="nav_build">New Build</span>
            </button>
            <button class="tab-btn" data-tab="assets" onclick="switchTab('assets')">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1-1.5v-13A1.5 1.5 0 0 0 14.5 0h-13z"/>
                </svg>
                <span data-translate="nav_assets">Assets</span>
            </button>
            <button class="tab-btn" data-tab="jobs" onclick="switchTab('jobs')">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M7 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-1z"/>
                </svg>
                <span data-translate="nav_jobs">Jobs</span>
            </button>
            <button class="tab-btn" data-tab="admin" onclick="switchTab('admin')">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.892 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.892-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/>
                </svg>
                <span data-translate="nav_admin">Admin</span>
            </button>
        </div>
		-->

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
						<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
							<path d="M6 1v3H1V1h5zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12v3h-5v-3h5zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8v7H1V8h5zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6v7h-5V1h5zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z"/>
						</svg>
                        <span data-translate="dashboard_system_overview">System Overview</span>
                    </h2>
                </div>
                <div class="card-content">
                    <div class="status-grid">
                        <div class="status-card">
                            <span class="status-number" id="totalJobs">0</span>
                            <div class="status-label" data-translate="stats_total_jobs">Total Jobs</div>
                        </div>
                        <div class="status-card">
                            <span class="status-number" id="runningJobs">0</span>
                            <div class="status-label" data-translate="stats_running">Running</div>
                        </div>
                        <div class="status-card">
                            <span class="status-number" id="completedJobs">0</span>
                            <div class="status-label" data-translate="stats_completed">Completed</div>
                        </div>
                        <div class="status-card">
                            <span class="status-number" id="failedJobs">0</span>
                            <div class="status-label" data-translate="stats_failed">Failed</div>
                        </div>
                    </div>

                    <!-- Active Job Display -->
                    <div id="activeJobCard" class="content-card" style="display: none;">
                        <div class="card-header">
                            <h3 class="card-title" data-translate="active_job_title">Active Job</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <strong data-translate="job_label">Job:</strong> <span id="activeJobTitle">-</span><br>
                                    <strong data-translate="status_label">Status:</strong> <span id="activeJobStatus" class="status-badge">-</span>
                                </div>
                                <div>
                                    <strong data-translate="progress_label">Progress:</strong> <span id="activeJobProgress">0%</span><br>
                                    <strong data-translate="step_label">Step:</strong> <span id="activeJobStep">-</span>
                                </div>
                            </div>
                            <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; height: 100px; overflow-y: auto; font-family: monospace; font-size: 14px;" id="activeJobLogs">
                                <span data-translate="waiting_job_updates">Waiting for job updates...</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden; margin-top: 15px;">
                                <div id="activeJobProgressBar" style="height: 100%; background: var(--siemens-bright-petrol); transition: width 0.3s ease; width: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <h3 class="card-title" data-translate="recent_jobs_title">Recent Jobs</h3>
                        </div>
                        <div class="card-content">
                            <div id="recentJobsList">
                                <p style="text-align: center; color: var(--siemens-text-secondary); padding: 40px;" data-translate="no_jobs_yet">
                                    No jobs yet. Start a new build to see activity here.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Build Tab -->
        <div id="build" class="tab-content">
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 12px;">
                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                        </svg>
                        <span data-translate="build_create_new">Create New Build</span>
                    </h2>
                </div>
                <div class="card-content">
                    <form id="buildForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                            <div class="form-group">
                                <label class="form-label" for="deviceSelect" data-translate="build_device_config">Device Configuration</label>
                                <select id="deviceSelect" class="form-control" required>
                                    <option value="" data-translate="select_device">Select device...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="osSelect" data-translate="build_operating_system">Operating System</label>
                                <select id="osSelect" class="form-control" disabled required>
                                    <option value="" data-translate="select_os">Select OS...</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                            <div>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="skipDrivers">
                                    <span data-translate="skip_drivers">Skip driver integration</span>
                                </label>
                            </div>
                            <div>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="skipUpdates">
                                    <span data-translate="skip_updates">Skip update integration</span>
                                </label>
                            </div>
                        </div>

                        <div id="buildPreview" style="display: none; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 24px;">
                            <h4 style="margin-bottom: 15px;" data-translate="build_preview">Build Preview</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 14px;">
                                <div><strong data-translate="device_label">Device:</strong> <span id="previewDevice">-</span></div>
                                <div><strong data-translate="os_label">OS:</strong> <span id="previewOS">-</span></div>
                                <div><strong data-translate="wim_path_label">WIM Path:</strong> <span id="previewWimPath">-</span></div>
                                <div><strong data-translate="sbi_label">SBI:</strong> <span id="previewSBI">-</span></div>
                                <div><strong data-translate="drivers_label">Drivers:</strong> <span id="previewDrivers">-</span></div>
                                <div><strong data-translate="updates_label">Updates:</strong> <span id="previewUpdates">-</span></div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="startBuildBtn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                            </svg>
                            <span data-translate="start_build">Start Build</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Assets Tab -->
        <div id="assets" class="tab-content">
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 12px;">
                            <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 14.5 0h-13z"/>
                        </svg>
                        <span data-translate="asset_management">Asset Management</span>
                    </h2>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 16px; margin-bottom: 32px;">
                        <div class="form-group">
                            <label class="form-label" for="assetDeviceFilter" data-translate="device_filter">Device Filter</label>
                            <select id="assetDeviceFilter" class="form-control">
                                <option value="" data-translate="all_devices">All Devices</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="assetOSFilter" data-translate="os_filter">OS Filter</label>
                            <select id="assetOSFilter" class="form-control">
                                <option value="" data-translate="all_os">All OS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">&nbsp;</label>
                            <button type="button" class="btn btn-secondary" onclick="refreshAssets()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                </svg>
                                <span data-translate="refresh">Refresh</span>
                            </button>
                        </div>
                    </div>

                    <div id="assetsContent">
                        <p style="text-align: center; color: var(--siemens-text-secondary); padding: 40px;" data-translate="select_device_os_assets">
                            Select device and OS to view available assets
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Jobs Tab -->
        <div id="jobs" class="tab-content">
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 12px;">
                            <path d="M7 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-1z"/>
                        </svg>
                        <span data-translate="build_jobs">Build Jobs</span>
                        <button class="btn btn-secondary" onclick="refreshJobs()" style="margin-left: auto; padding: 8px 16px; font-size: 14px;">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            </svg>
                            <span data-translate="refresh">Refresh</span>
                        </button>
                    </h2>
                </div>
                <div class="card-content">
                    <div id="jobsList">
                        <p style="text-align: center; color: var(--siemens-text-secondary); padding: 40px;" data-translate="no_build_jobs">
                            No build jobs found. Start your first build to see it here.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <!-- Database Overview -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 12px;">
                            <path d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2z"/>
                        </svg>
                        <span data-translate="admin_database">Database Management</span>
                        <button class="btn btn-secondary" onclick="loadDatabaseInfo()" style="margin-left: auto; padding: 8px 16px; font-size: 14px;">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            </svg>
                            <span data-translate="refresh">Refresh</span>
                        </button>
                    </h2>
                </div>
                <div class="card-content">
                    <div class="status-grid">
                        <div class="status-card">
                            <span class="status-number" id="dbJobCount">-</span>
                            <div class="status-label" data-translate="db_jobs_stored">Jobs Stored</div>
                        </div>
                        <div class="status-card">
                            <span class="status-number" id="dbLogCount">-</span>
                            <div class="status-label" data-translate="db_logs_stored">Log Entries</div>
                        </div>
                        <div class="status-card">
                            <span class="status-number" id="dbSize">-</span>
                            <div class="status-label" data-translate="db_size">Database Size</div>
                        </div>
                        <div class="status-card">
                            <span class="status-number" id="dbEventCount">-</span>
                            <div class="status-label" data-translate="db_events">System Events</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 32px;">
                        <div class="content-card" style="margin: 0;">
                            <div class="card-header">
                                <h3 class="card-title" data-translate="db_maintenance">Database Maintenance</h3>
                            </div>
                            <div class="card-content">
                                <p data-translate="db_maintenance_desc">Clean up old data and optimize database performance.</p>
                                
                                <div style="margin: 20px 0;">
                                    <label class="form-label" for="cleanupDays" data-translate="cleanup_days">Days to keep:</label>
                                    <select id="cleanupDays" class="form-control" style="margin-bottom: 16px;">
                                        <option value="30">30 days</option>
                                        <option value="60">60 days</option>
                                        <option value="90" selected>90 days</option>
                                        <option value="180">180 days</option>
                                        <option value="365">1 year</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-warning" onclick="cleanupDatabase()" id="cleanupBtn">
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    </svg>
                                    <span data-translate="cleanup_now">Cleanup Now</span>
                                </button>
                                
                                <button class="btn btn-secondary" onclick="updateStatistics()" style="margin-left: 8px;">
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM11 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 17 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5z"/>
                                    </svg>
                                    <span data-translate="update_stats">Update Stats</span>
                                </button>
                            </div>
                        </div>

                        <div class="content-card" style="margin: 0;">
                            <div class="card-header">
                                <h3 class="card-title" data-translate="db_backup">Database Backup</h3>
                            </div>
                            <div class="card-content">
                                <p data-translate="db_backup_desc">Download a copy of the database for backup purposes.</p>
                                
                                <div style="margin: 20px 0;">
                                    <div style="font-size: 14px; color: var(--siemens-text-secondary);">
                                        <strong data-translate="db_location">Database Location:</strong><br>
                                        <code id="dbPath">runtime/data/kassia_jobs.db</code>
                                    </div>
                                </div>
                                
                                <button class="btn btn-secondary" onclick="downloadDatabaseBackup()">
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                                    </svg>
                                    <span data-translate="download_backup">Download Backup</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Chart -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 12px;">
                            <path d="M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zM1 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
                        </svg>
                        <span data-translate="admin_statistics">Job Statistics</span>
                        <div style="margin-left: auto; display: flex; gap: 8px;">
                            <select id="statsDays" onchange="loadStatistics()" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ddd;">
                                <option value="7">7 days</option>
                                <option value="30" selected>30 days</option>
                                <option value="90">90 days</option>
                            </select>
                            <button class="btn btn-secondary" onclick="loadStatistics()" style="padding: 8px 16px; font-size: 14px;">
                                <span data-translate="refresh">Refresh</span>
                            </button>
                        </div>
                    </h2>
                </div>
                <div class="card-content">
                    <div id="statisticsChart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--siemens-text-secondary);">
                        <div style="text-align: center;">
                            <div class="loading-spinner" style="margin-bottom: 16px;"></div>
                            <span data-translate="loading_statistics">Loading statistics...</span>
                        </div>
                    </div>
                    
                    <div id="statisticsTable" style="margin-top: 24px;">
                        <!-- Statistics table will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="/static/js/translations.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/kassia-app.js"></script>
    
    <script>
        // Database Management Functions
        async function loadDatabaseInfo() {
            try {
                uiManager.showLoading('dbJobCount', 'Loading...');
                
                const dbInfo = await api.get('/api/admin/database/info');
                
                // Update UI elements
                document.getElementById('dbJobCount').textContent = dbInfo.job_count || 0;
                document.getElementById('dbLogCount').textContent = dbInfo.log_count || 0;
                document.getElementById('dbSize').textContent = uiManager.formatBytes(dbInfo.database_size_bytes || 0);
                document.getElementById('dbEventCount').textContent = dbInfo.event_count || 0;
                document.getElementById('dbPath').textContent = dbInfo.database_path || 'Unknown';
                
                console.log('✅ Database info loaded:', dbInfo);
                
            } catch (error) {
                console.error('❌ Failed to load database info:', error);
                uiManager.showToast('Failed to load database information', 'error');
            } finally {
                uiManager.hideLoading('dbJobCount');
            }
        }

        async function cleanupDatabase() {
            const days = document.getElementById('cleanupDays').value;
            
            if (!confirm(`Are you sure you want to delete all data older than ${days} days? This action cannot be undone.`)) {
                return;
            }
            
            try {
                uiManager.showLoading('cleanupBtn', 'Cleaning up...');
                
                const result = await api.post(`/api/admin/maintenance/cleanup?days=${days}`);
                
                uiManager.showToast(`Database cleanup completed for data older than ${days} days`, 'success');
                
                // Reload database info
                await loadDatabaseInfo();
                
            } catch (error) {
                console.error('❌ Failed to cleanup database:', error);
                uiManager.showToast('Failed to cleanup database', 'error');
            } finally {
                uiManager.hideLoading('cleanupBtn');
            }
        }

        async function updateStatistics() {
            try {
                const result = await api.post('/api/admin/maintenance/update-statistics');
                
                uiManager.showToast('Statistics updated successfully', 'success');
                
                // Reload statistics if visible
                if (uiManager.currentTab === 'admin') {
                    await loadStatistics();
                }
                
            } catch (error) {
                console.error('❌ Failed to update statistics:', error);
                uiManager.showToast('Failed to update statistics', 'error');
            }
        }

        async function downloadDatabaseBackup() {
            try {
                // Since we can't directly download the SQLite file via API,
                // we'll show the path for manual backup
                const dbInfo = await api.get('/api/admin/database/info');
                
                const message = `Database backup location:\n${dbInfo.database_path}\n\nSize: ${uiManager.formatBytes(dbInfo.database_size_bytes)}\n\nCopy this file to create a backup.`;
                
                alert(message);
                
            } catch (error) {
                console.error('❌ Failed to get database backup info:', error);
                uiManager.showToast('Failed to get backup information', 'error');
            }
        }

        async function loadStatistics() {
            const days = document.getElementById('statsDays').value;
            
            try {
                const stats = await api.get(`/api/admin/statistics?days=${days}`);
                
                displayStatistics(stats);
                
                console.log('✅ Statistics loaded:', stats);
                
            } catch (error) {
                console.error('❌ Failed to load statistics:', error);
                uiManager.showToast('Failed to load statistics', 'error');
            }
        }

        function displayStatistics(stats) {
            const chartEl = document.getElementById('statisticsChart');
            const tableEl = document.getElementById('statisticsTable');
            
            if (stats.length === 0) {
                chartEl.innerHTML = '<p style="text-align: center; color: var(--siemens-text-secondary);">No statistics data available</p>';
                tableEl.innerHTML = '';
                return;
            }
            
            // Simple chart visualization
            let chartHtml = '<div style="display: flex; align-items: end; gap: 4px; height: 200px; padding: 20px;">';
            
            const maxJobs = Math.max(...stats.map(s => s.total_jobs));
            
            stats.reverse().forEach((stat, index) => {
                const height = maxJobs > 0 ? (stat.total_jobs / maxJobs) * 150 : 0;
                const completedRatio = stat.total_jobs > 0 ? (stat.completed_jobs / stat.total_jobs) * 100 : 0;
                
                chartHtml += `
                    <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                        <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 8px;">
                            <div style="font-size: 12px; font-weight: bold; margin-bottom: 2px;">${stat.total_jobs}</div>
                            <div style="width: 20px; height: ${height}px; background: ${completedRatio > 80 ? '#28a745' : completedRatio > 50 ? '#ffc107' : '#dc3545'}; border-radius: 2px;"></div>
                        </div>
                        <div style="font-size: 10px; transform: rotate(-45deg); margin-top: 8px;">${stat.date.split('-')[2]}/${stat.date.split('-')[1]}</div>
                    </div>
                `;
            });
            
            chartHtml += '</div>';
            chartEl.innerHTML = chartHtml;
            
            // Statistics table
            let tableHtml = `
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--siemens-light-gray);">
                            <th style="padding: 8px; text-align: left; border: 1px solid #ddd;">Date</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">Total</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">Completed</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">Failed</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">Success Rate</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">Avg Duration</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            stats.reverse().forEach(stat => {
                const successRate = stat.total_jobs > 0 ? ((stat.completed_jobs / stat.total_jobs) * 100).toFixed(1) : '0.0';
                const avgDuration = stat.avg_duration_seconds ? uiManager.formatDuration(Math.round(stat.avg_duration_seconds)) : '-';
                
                tableHtml += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${stat.date}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${stat.total_jobs}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd; color: #28a745;">${stat.completed_jobs}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd; color: #dc3545;">${stat.failed_jobs}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: ${parseFloat(successRate) >= 80 ? '#28a745' : parseFloat(successRate) >= 50 ? '#ffc107' : '#dc3545'};">${successRate}%</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${avgDuration}</td>
                    </tr>
                `;
            });
            
            tableHtml += '</tbody></table>';
            tableEl.innerHTML = tableHtml;
        }

        // Initialize the application when all scripts are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Kassia WebUI Application...');
            
            // Wait a bit for all managers to be ready
            setTimeout(() => {
                if (window.KassiaApp) {
                    window.kassiaApp = new window.KassiaApp();
                } else {
                    console.error('❌ KassiaApp class not found');
                }
            }, 100);

            // Enhanced UI Manager with Admin functions
            if (window.uiManager) {
                const originalOnTabSwitch = window.uiManager.onTabSwitch;
                window.uiManager.onTabSwitch = function(tabName) {
                    if (originalOnTabSwitch) {
                        originalOnTabSwitch.call(this, tabName);
                    }
                    
                    if (tabName === 'admin') {
                        setTimeout(() => {
                            loadDatabaseInfo();
                            loadStatistics();
                        }, 100);
                    }
                };
            }
        });
    </script>
</body>
</html>